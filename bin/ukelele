#! /usr/bin/env python
import sys
from os.path import splitext
from src.antlr.antlr4.FileStream import FileStream
from src.antlr.antlr4.CommonTokenStream import CommonTokenStream
from src.ukeleleLexer import ukeleleLexer
from src.ukeleleParser import ukeleleParser
from src.symbolsTable import SymbolsTable

def main():
    if len(sys.argv) == 2:
        char_stream = FileStream(sys.argv[1])
        lexer = ukeleleLexer(char_stream)
        tokens = CommonTokenStream(lexer)
        parser = ukeleleParser(tokens);

        initial_ts = SymbolsTable()
        code = parser.s(initial_ts)

        filename, fileextesion = splitext(sys.argv[1])

        with open(filename + '.ukil', 'w') as out:
            out.write(code.code)

    else:
        print 'Please provide a valid filename to compile'

if __name__ == '__main__':
    main()
